var b=Object.defineProperty,x=Object.defineProperties;var $=Object.getOwnPropertyDescriptors;var c=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable;var d=(e,a,t)=>a in e?b(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,u=(e,a)=>{for(var t in a||(a={}))C.call(a,t)&&d(e,t,a[t]);if(c)for(var t of c(a))y.call(a,t)&&d(e,t,a[t]);return e},f=(e,a)=>x(e,$(a));import{V as S,n as i,A as I,a as T,b as w,s as F,p as h,_ as P}from"./vendor.e64f7ccf.js";import{V as k,a as D,b as H}from"./VuetableFilterBar.fb1f9fb1.js";var U=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("main")},R=[];const p=window.Vue;p.use(S);const V=p.extend({mounted:function(){this.$confetti.start({shape:"rect",colors:["DodgerBlue","OliveDrab","Gold","pink","SlateBlue","lightblue","Violet","PaleGreen","SteelBlue","SandyBrown","Chocolate","Crimson"]}),setTimeout(()=>{this.$confetti.stop()},5e3)},methods:{}}),v={};var N=i(V,U,R,!1,L,null,null,null);function L(e){for(let a in v)this[a]=v[a]}var A=function(){return N.exports}(),B=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("apexcharts",{attrs:{width:"100%",height:"200px",type:"area",options:e.chartOptions,series:e.series}})},M=[];const O=e=>e.map(function(a){return Math.max.apply(null,a)}),E=e=>({baseURL:e,headers:{"X-Requested-With":"XMLHttpRequest"}}),j=(e,a,t,r)=>{e.get(a,{params:t}).then(n=>{r&&r(n.data)}).catch(n=>{console.error(n)})},z={components:{apexcharts:I},props:{title:{type:String,default:""},subTitle:{type:String,default:""},range:{type:String,default:""},siteId:{type:Number,default:0},refreshIntervalSecs:{type:Number,default:3},apiUrl:{type:String,default:""}},data:function(){return{chartOptions:{chart:{id:"vuechart-dashboard",type:"area",height:160,sparkline:{enabled:!0}},colors:["#008FFB","#DCE6EC"],stroke:{curve:"straight",width:3},fill:{opacity:.2,gradient:{enabled:!0}},xaxis:{type:"category",labels:{show:!1,minHeight:"20px"},crosshairs:{width:1}},yaxis:{min:0},title:{text:this.title,offsetX:0,style:{fontSize:"24px",cssClass:"apexcharts-yaxis-title"}},subtitle:{text:this.subTitle,offsetX:0,style:{fontSize:"14px",cssClass:"apexcharts-yaxis-title"}}},series:[{name:"empty",data:[0]}]}},created(){this.getSeriesData()},mounted(){this.refreshIntervalSecs&&setInterval(()=>{this.getSeriesData()},this.refreshIntervalSecs*1e3)},methods:{getSeriesData:async function(){const e=T.create(E(this.apiUrl));await j(e,"",{range:this.range,siteId:this.siteId},a=>{if(a[0]!==void 0){const t=Math.round(O([a[0].data])[0]+1.5);this.chartOptions=f(u({},this.chartOptions),{yaxis:{min:0,max:t,labels:{show:!1,minHeight:"20px"}},xaxis:{categories:a[0].labels,type:"category",labels:{show:!1,minHeight:"20px"},crosshairs:{width:1}},labels:a[0].labels}),this.series=a}})}}},m={};var q=i(z,B,M,!1,X,null,null,null);function X(e){for(let a in m)this[a]=m[a]}var K=function(){return q.exports}(),G=[{name:"__checkbox",titleClass:"center aligned",dataClass:"center aligned"},{name:"__component:file-not-found-url",sortField:"redirectSrcUrl",title:"404 File Not Found URL",titleClass:"center",dataClass:"center"},{name:"referrerUrl",sortField:"referrerUrl",title:"Last Referrer URL",titleClass:"center",dataClass:"center",callback:"urlFormatter"},{name:"remoteIp",sortField:"remoteIp",title:"Remote IP",titleClass:"center",dataClass:"center",callback:"ipFormatter"},{name:"hitCount",sortField:"hitCount",title:"Hits",titleClass:"text-right",dataClass:"text-right"},{name:"hitLastTime",sortField:"hitLastTime",title:"Last Hit",titleClass:"center",dataClass:"center"},{name:"handledByRetour",sortField:"handledByRetour",title:"Handled",titleClass:"text-center",dataClass:"text-center",callback:"boolFormatter"},{name:"addLink",sortField:"addLink",title:"",titleClass:"text-center",dataClass:"text-center",callback:"addUrlFormatter"}],W=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("a",{staticClass:"go",attrs:{href:e.linkHref,title:e.linkTitle}},[e._v(e._s(e.rowData.redirectSrcUrl))])])},J=[];const Q={props:{rowData:{type:Object,required:!0},rowIndex:{type:Number,default:0}},computed:{linkHref:function(){let e=this.rowData.redirectSrcUrl;return e===""?"":(!new RegExp("^(?:[a-z]+:)?//","i").test(e)&&!e.includes("$")&&(e=Craft.getSiteUrl(Craft.trim(e,"/"))),e)},linkTitle:function(){let e="";return e+="User Agent: "+this.rowData.userAgent+`

`,e+="Message: "+this.rowData.exceptionMessage+`

`,e+="File Path: "+this.rowData.exceptionFilePath+`

`,e+="Line No.: "+this.rowData.exceptionFileLine,e}}},g={};var Y=i(Q,W,J,!1,Z,null,null,null);function Z(e){for(let a in g)this[a]=g[a]}var ee=function(){return Y.exports}(),te=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("div",{directives:[{name:"show",rawName:"v-show",value:e.numSelected!==0,expression:"numSelected !== 0"}]},[t("form",{attrs:{method:"post","accept-charset":"UTF-8"}},[t("input",{attrs:{type:"hidden",name:e.csrfTokenName},domProps:{value:e.csrfTokenValue}}),e._l(e.selectedIds,function(r){return t("input",{key:r,attrs:{type:"hidden",name:"statisticIds[]"},domProps:{value:r}})}),t("label",{staticClass:"text-gray-600"},[e._v(e._s(e.numSelected)+" statistic"),e.numSelected!==1?t("span",[e._v("s")]):e._e(),e._v(":")]),e._m(0)],2)]),t("vuetable-filter-bar",{directives:[{name:"show",rawName:"v-show",value:e.numSelected===0,expression:"numSelected === 0"}],attrs:{"initial-filter-text":e.filterText}}),t("div",{staticClass:"vuetable-pagination clearafter"},[t("vuetable-pagination-info",{ref:"paginationInfoTop"}),t("div",{staticClass:"floated left pl-3 pt-3 text-gray-600"},[t("div",{staticClass:"select"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.retourHandled,expression:"retourHandled"}],staticClass:"fieldtoggle",attrs:{"data-target-prefix":"retour-handled-",name:"retourHandled"},on:{change:function(r){var n=Array.prototype.filter.call(r.target.options,function(s){return s.selected}).map(function(s){var l="_value"in s?s._value:s.value;return l});e.retourHandled=r.target.multiple?n:n[0]}}},[t("option",{attrs:{value:"all",selected:""}},[e._v(" All ")]),t("option",{attrs:{value:"handled"}},[e._v(" Handled ")]),t("option",{attrs:{value:"nothandled"}},[e._v(" Not Handled ")])])])]),t("vuetable-pagination",{ref:"paginationTop",on:{"vuetable-pagination:change-page":e.onChangePage}}),t("div",{staticClass:"floated left vuetable-pagination-info py-3"},[t("div",{staticClass:"inline pl-3 text-gray-600"},[e._v(" Per-page: ")]),t("div",{staticClass:"inline pl-3 text-gray-600"},[t("div",{staticClass:"select"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.perPage,expression:"perPage"}],staticClass:"fieldtoggle",attrs:{"data-target-prefix":"per-page-",name:"perPage"},on:{change:function(r){var n=Array.prototype.filter.call(r.target.options,function(s){return s.selected}).map(function(s){var l="_value"in s?s._value:s.value;return l});e.perPage=r.target.multiple?n:n[0]}}},[t("option",{attrs:{value:"20",selected:""}},[e._v(" 20 ")]),t("option",{attrs:{value:"50"}},[e._v(" 50 ")]),t("option",{attrs:{value:"100"}},[e._v(" 100 ")]),t("option",{attrs:{value:"500"}},[e._v(" 500 ")])])])])])],1),t("vuetable",{ref:"vuetable",attrs:{"api-url":e.apiUrl,"per-page":e.perPage,fields:e.fields,css:e.css,"sort-order":e.sortOrder,"append-params":e.moreParams},on:{"vuetable:pagination-data":e.onPaginationData}}),t("div",{staticClass:"vuetable-pagination clearafter"},[t("vuetable-pagination-info",{ref:"paginationInfo"}),t("vuetable-pagination",{ref:"pagination",on:{"vuetable-pagination:change-page":e.onChangePage}})],1)],1)},ae=[function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"btngroup inline"},[t("div",{staticClass:"btn menubtn",attrs:{"data-icon":"settings"}}),t("div",{staticClass:"menu",attrs:{"data-align":"right"}},[t("ul",[t("li",[t("a",{staticClass:"formsubmit",attrs:{"data-action":"retour/statistics/delete-statistics"}},[e._v("Delete")])])])])])}];const re={components:{"file-not-found-url":ee,vuetable:w,"vuetable-pagination":k,"vuetable-pagination-info":D,"vuetable-filter-bar":H},mixins:[F],props:{siteId:{type:Number,default:0},refreshIntervalSecs:{type:Number,default:3},apiUrl:{type:String,default:""}},data:function(){return{moreParams:{siteId:this.siteId},css:{tableClass:"data fullwidth retour-dashboard",ascendingIcon:"menubtn retour-menubtn-asc",descendingIcon:"menubtn retour-menubtn-desc"},sortOrder:[{field:"hitCount",sortField:"hitCount",direction:"desc"}],fields:G,numSelected:0,perPage:20,selectedIds:[],retourHandled:"all",filterText:""}},computed:{csrfTokenName:function(){return window.Craft.csrfTokenName},csrfTokenValue:function(){return window.Craft.csrfTokenValue}},watch:{retourHandled:function(){this.moreParams={siteId:this.siteId},this.moreParams={siteId:this.siteId,filter:this.filterText,handled:this.retourHandled},this.$events.fire("refresh-table",this.$refs.vuetable)},perPage:function(){this.$events.fire("refresh-table",this.$refs.vuetable)}},mounted(){this.$events.$on("filter-set",e=>this.onFilterSet(e)),this.$events.$on("filter-reset",()=>this.onFilterReset()),this.$refs.vuetable.$on("vuetable:checkbox-toggled",(e,a)=>this.onCheckboxToggled(e,a)),this.$refs.vuetable.$on("vuetable:checkbox-toggled-all",e=>this.onCheckboxToggled(e,null)),this.refreshIntervalSecs&&setInterval(()=>{typeof this.$refs.pagination!="undefined"&&this.$refs.pagination.isOnFirstPage&&typeof this.$refs.vuetable!="undefined"&&this.$refs.vuetable.refresh()},this.refreshIntervalSecs*1e3)},methods:{getSaveStateConfig(){return{cacheKey:"retour-dashboard-state-"+Craft.username+Craft.siteId,ignoreProperties:["numSelected","selectedIds"]}},onFilterSet(e){this.filterText=e,this.moreParams={filter:this.filterText,handled:this.retourHandled,siteId:this.siteId},this.$events.fire("refresh-table",this.$refs.vuetable)},onFilterReset(){this.filterText="",this.moreParams={filter:this.filterText,handled:this.retourHandled,siteId:this.siteId},this.$events.fire("refresh-table",this.$refs.vuetable)},onPaginationData(e){this.$refs.paginationTop.setPaginationData(e),this.$refs.paginationInfoTop.setPaginationData(e),this.$refs.pagination.setPaginationData(e),this.$refs.paginationInfo.setPaginationData(e)},onChangePage(e){this.$refs.vuetable.changePage(e)},onCheckboxToggled(){this.numSelected=0,this.selectedIds=[],this.$refs.vuetable!==void 0&&this.$refs.vuetable.selectedTo!==void 0&&(this.numSelected=this.$refs.vuetable.selectedTo.length,this.selectedIds=this.$refs.vuetable.selectedTo)},urlFormatter(e){return e===""?"":(e=h.sanitize(e),`
                <a class="go" href="${e}" title="${e}" target="_blank" rel="noopener">${e}</a>
                `)},ipFormatter(e){return e===""?"":(e=h.sanitize(e),`
                <a class="go" href="https://whatismyipaddress.com/ip/${e}" title="Lookup ${e}" target="_blank" rel="noopener">${e}</a>
                `)},boolFormatter(e){return e==1?`
                <span style="color: green;">&#x2714;</span>
                `:`
                <span style="color: red;">&#x2716;</span>
                `},addUrlFormatter(e){return e===""?"":`
                <a class="add icon" href="${e}" title="Add"></a>
                `}}},_={};var se=i(re,te,ae,!1,ne,null,null,null);function ne(e){for(let a in _)this[a]=_[a]}var ie=function(){return se.exports}();const o=window.Vue;o.use(P);new o({el:"#cp-nav-content",components:{ConfettiParty:A,DashboardChart:K,DashboardTable:ie},data:{},mounted(){this.$events.$on("refresh-table",e=>this.onTableRefresh(e))},methods:{onTableRefresh(e){o.nextTick(()=>e.refresh())}}});
//# sourceMappingURL=dashboard.4374c374.js.map
