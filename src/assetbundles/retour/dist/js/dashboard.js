/*!
 * @project        retour
 * @name           dashboard.js
 * @author         Andrew Welch
 * @build          Wed Dec 09 2020 05:04:58 GMT+0000 (Coordinated Universal Time)
 * @copyright      Copyright (c) 2020 Â©2020 nystudio107.com
 *
 */
(self.webpackChunkretour=self.webpackChunkretour||[]).push([[966],{3437:function(e,t,a){"use strict";var n=a(7495),r=a(6268),s=a.n(r);Vue.use(s());var i={mounted:function(){var e=this;this.$confetti.start({shape:"rect",colors:["DodgerBlue","OliveDrab","Gold","pink","SlateBlue","lightblue","Violet","PaleGreen","SteelBlue","SandyBrown","Chocolate","Crimson"]}),setTimeout((function(){e.$confetti.stop()}),5e3)},methods:{}},o=a(1900),l=(0,o.Z)(i,(function(){var e=this.$createElement;return(this._self._c||e)("main")}),[],!1,null,null,null).exports,c=(a(1249),a(9653),a(9601),a(7757)),u=a.n(c),d=a(9713),h=a.n(d),f=(a(5666),a(8926)),p=a.n(f),v=a(9669),m=a.n(v),g=a(7166);function b(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function x(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?b(Object(a),!0).forEach((function(t){h()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):b(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var C,y=function(e,t,a,n){e.get(t,{params:a}).then((function(e){n&&n(e.data)})).catch((function(e){console.error(e)}))},_={components:{apexcharts:a.n(g)()},props:{title:String,subTitle:String,range:String,siteId:{type:Number,default:0},refreshIntervalSecs:{type:Number,default:3},apiUrl:{type:String,default:""}},methods:{getSeriesData:(C=p()(u().mark((function e(){var t,a=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=m().create({baseURL:this.apiUrl,headers:{"X-Requested-With":"XMLHttpRequest"}}),e.next=3,y(t,"",{range:this.range,siteId:this.siteId},(function(e){var t;if(Object.assign({},a.chartOptions),void 0!==e[0]){var n=Math.round((t=[e[0].data],t.map((function(e){return Math.max.apply(null,e)})))[0]+1.5);a.chartOptions=x(x({},a.chartOptions),{yaxis:{min:0,max:n,labels:{show:!1,minHeight:"20px"}},xaxis:{categories:e[0].labels,type:"category",labels:{show:!1,minHeight:"20px"},crosshairs:{width:1}},labels:e[0].labels}),a.series=e}}));case 3:case"end":return e.stop()}}),e,this)}))),function(){return C.apply(this,arguments)})},created:function(){this.getSeriesData()},mounted:function(){var e=this;this.refreshIntervalSecs&&setInterval((function(){e.getSeriesData()}),1e3*this.refreshIntervalSecs)},data:function(){return{chartOptions:{chart:{id:"vuechart-dashboard",type:"area",height:160,sparkline:{enabled:!0}},colors:["#008FFB","#DCE6EC"],stroke:{curve:"straight",width:3},fill:{opacity:.2,gradient:{enabled:!0}},xaxis:{type:"category",labels:{show:!1,minHeight:"20px"},crosshairs:{width:1}},yaxis:{min:0},title:{text:this.title,offsetX:0,style:{fontSize:"24px",cssClass:"apexcharts-yaxis-title"}},subtitle:{text:this.subTitle,offsetX:0,style:{fontSize:"14px",cssClass:"apexcharts-yaxis-title"}}},series:[{name:"empty",data:[0]}]}}},w=(0,o.Z)(_,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("apexcharts",{attrs:{width:"100%",height:"200px",type:"area",options:e.chartOptions,series:e.series}})}),[],!1,null,null,null).exports,I=(a(2222),[{name:"__checkbox",titleClass:"center aligned",dataClass:"center aligned"},{name:"__component:file-not-found-url",sortField:"redirectSrcUrl",title:"404 File Not Found URL",titleClass:"center",dataClass:"center"},{name:"referrerUrl",sortField:"referrerUrl",title:"Last Referrer URL",titleClass:"center",dataClass:"center",callback:"urlFormatter"},{name:"remoteIp",sortField:"remoteIp",title:"Remote IP",titleClass:"center",dataClass:"center",callback:"ipFormatter"},{name:"hitCount",sortField:"hitCount",title:"Hits",titleClass:"text-right",dataClass:"text-right"},{name:"hitLastTime",sortField:"hitLastTime",title:"Last Hit",titleClass:"center",dataClass:"center"},{name:"handledByRetour",sortField:"handledByRetour",title:"Handled",titleClass:"text-center",dataClass:"text-center",callback:"boolFormatter"},{name:"addLink",sortField:"addLink",title:"",titleClass:"text-center",dataClass:"text-center",callback:"addUrlFormatter"}]),$={props:{rowData:{type:Object,required:!0},rowIndex:{type:Number}},computed:{linkTitle:function(){var e="";return e+="User Agent: "+this.rowData.userAgent+"\n\n",e+="Message: "+this.rowData.exceptionMessage+"\n\n",e+="File Path: "+this.rowData.exceptionFilePath+"\n\n",e+="Line No.: "+this.rowData.exceptionFileLine}}},S=(0,o.Z)($,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("a",{staticClass:"go",attrs:{href:e.rowData.redirectSrcUrl,title:e.linkTitle}},[e._v(e._s(e.rowData.redirectSrcUrl))])])}),[],!1,null,null,null).exports,k=a(6545),P=a(5931),F=a(7850),O=a(9546);Vue.component("file-not-found-url",S);var T={components:{vuetable:k.Z,"vuetable-pagination":P.Z,"vuetable-pagination-info":F.Z,"vuetable-filter-bar":O.Z},props:{siteId:{type:Number,default:0},refreshIntervalSecs:{type:Number,default:3},apiUrl:{type:String,default:""}},data:function(){return{moreParams:{siteId:this.siteId},css:{tableClass:"data fullwidth retour-dashboard",ascendingIcon:"menubtn retour-menubtn-asc",descendingIcon:"menubtn retour-menubtn-desc"},sortOrder:[{field:"hitCount",sortField:"hitCount",direction:"desc"}],fields:I,numSelected:0,selectedIds:[],retourHandled:"all"}},computed:{csrfTokenName:function(){return window.Craft.csrfTokenName},csrfTokenValue:function(){return window.Craft.csrfTokenValue}},watch:{retourHandled:function(e){this.moreParams={siteId:this.siteId},"all"!==e&&(this.moreParams={siteId:this.siteId,handled:e}),this.$events.fire("refresh-table",this.$refs.vuetable)}},mounted:function(){var e=this;this.$events.$on("filter-set",(function(t){return e.onFilterSet(t)})),this.$events.$on("filter-reset",(function(t){return e.onFilterReset()})),this.$refs.vuetable.$on("vuetable:checkbox-toggled",(function(t,a){return e.onCheckboxToggled(t,a)})),this.$refs.vuetable.$on("vuetable:checkbox-toggled-all",(function(t){return e.onCheckboxToggled(t,null)})),this.refreshIntervalSecs&&setInterval((function(){void 0!==e.$refs.pagination&&e.$refs.pagination.isOnFirstPage&&void 0!==e.$refs.vuetable&&e.$refs.vuetable.refresh()}),1e3*this.refreshIntervalSecs)},methods:{onFilterSet:function(e){this.moreParams={siteId:this.siteId,filter:e},this.$events.fire("refresh-table",this.$refs.vuetable)},onFilterReset:function(){this.moreParams={siteId:this.siteId},this.$events.fire("refresh-table",this.$refs.vuetable)},onPaginationData:function(e){this.$refs.paginationTop.setPaginationData(e),this.$refs.paginationInfoTop.setPaginationData(e),this.$refs.pagination.setPaginationData(e),this.$refs.paginationInfo.setPaginationData(e)},onChangePage:function(e){this.$refs.vuetable.changePage(e)},onCheckboxToggled:function(e,t){this.numSelected=0,this.selectedIds=[],void 0!==this.$refs.vuetable&&void 0!==this.$refs.vuetable.selectedTo&&(this.numSelected=this.$refs.vuetable.selectedTo.length,this.selectedIds=this.$refs.vuetable.selectedTo)},urlFormatter:function(e){return""===e?"":'\n            <a class="go" href="'.concat(e,'" title="').concat(e,'" target="_blank" rel="noopener">').concat(e,"</a>\n            ")},ipFormatter:function(e){return""===e?"":'\n            <a class="go" href="https://whatismyipaddress.com/ip/'.concat(e,'" title="Lookup ').concat(e,'" target="_blank" rel="noopener">').concat(e,"</a>\n            ")},boolFormatter:function(e){return 1==e?'\n            <span style="color: green;">&#x2714;</span>\n            ':'\n            <span style="color: red;">&#x2716;</span>\n            '},addUrlFormatter:function(e){return""===e?"":'\n            <a class="add icon" href="'.concat(e,'" title="Add"></a>\n            ')}}},D=(0,o.Z)(T,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"py-4"},[a("div",{directives:[{name:"show",rawName:"v-show",value:0!==e.numSelected,expression:"numSelected !== 0"}]},[a("form",{attrs:{method:"post","accept-charset":"UTF-8"}},[a("input",{attrs:{type:"hidden",name:e.csrfTokenName},domProps:{value:e.csrfTokenValue}}),e._v(" "),e._l(e.selectedIds,(function(e){return a("input",{attrs:{type:"hidden",name:"statisticIds[]"},domProps:{value:e}})})),e._v(" "),a("label",{staticClass:"text-gray-600"},[e._v(e._s(e.numSelected)+" statistic"),1!==e.numSelected?a("span",[e._v("s")]):e._e(),e._v(":")]),e._v(" "),e._m(0)],2)]),e._v(" "),a("vuetable-filter-bar",{directives:[{name:"show",rawName:"v-show",value:0===e.numSelected,expression:"numSelected === 0"}]}),e._v(" "),a("div",{staticClass:"vuetable-pagination clearafter"},[a("vuetable-pagination-info",{ref:"paginationInfoTop"}),e._v(" "),a("div",{staticClass:"left floated left pl-3 pt-3 text-gray-600"},[a("div",{staticClass:"select"},[a("select",{directives:[{name:"model",rawName:"v-model",value:e.retourHandled,expression:"retourHandled"}],staticClass:"fieldtoggle",attrs:{"data-target-prefix":"retour-handled-",name:"retourHandled"},on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.retourHandled=t.target.multiple?a:a[0]}}},[a("option",{attrs:{value:"all",selected:""}},[e._v("All")]),e._v(" "),a("option",{attrs:{value:"handled"}},[e._v("Handled")]),e._v(" "),a("option",{attrs:{value:"nothandled"}},[e._v("Not Handled")])])])]),e._v(" "),a("vuetable-pagination",{ref:"paginationTop",on:{"vuetable-pagination:change-page":e.onChangePage}})],1),e._v(" "),a("vuetable",{ref:"vuetable",attrs:{"api-url":e.apiUrl,"per-page":20,fields:e.fields,css:e.css,"sort-order":e.sortOrder,"append-params":e.moreParams},on:{"vuetable:pagination-data":e.onPaginationData}}),e._v(" "),a("div",{staticClass:"vuetable-pagination clearafter"},[a("vuetable-pagination-info",{ref:"paginationInfo"}),e._v(" "),a("vuetable-pagination",{ref:"pagination",on:{"vuetable-pagination:change-page":e.onChangePage}})],1)],1)}),[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"btngroup inline"},[a("div",{staticClass:"btn menubtn",attrs:{"data-icon":"settings"}}),e._v(" "),a("div",{staticClass:"menu",attrs:{"data-align":"right"}},[a("ul",[a("li",[a("a",{staticClass:"formsubmit",attrs:{"data-action":"retour/statistics/delete-statistics"}},[e._v("Delete")])])])])])}],!1,null,null,null).exports;Vue.use(n.Z);new Vue({el:"#cp-nav-content",components:{confetti:l,"dashboard-chart":w,"dashboard-table":D},data:{},methods:{onTableRefresh:function(e){Vue.nextTick((function(){return e.refresh()}))}},mounted:function(){var e=this;this.$events.$on("refresh-table",(function(t){return e.onTableRefresh(t)}))}})}},0,[[3437,666,216,351]]]);
//# sourceMappingURL=dashboard.js.map